(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{139:function(e,t){},211:function(e,t,n){},213:function(e,t,n){},250:function(e,t){},252:function(e,t){},262:function(e,t){},264:function(e,t){},291:function(e,t){},293:function(e,t){},294:function(e,t){},300:function(e,t){},302:function(e,t){},320:function(e,t){},322:function(e,t){},334:function(e,t){},337:function(e,t){},360:function(e,t,n){"use strict";n.r(t);var r=n(13),c=(n(211),n(0)),s=n.n(c),a=n(9),u=n(33),i=n(19),o=(n(213),n(388)),d=n(387),l=n(1),f=n.n(l),p=n(386),m=n.p+"static/media/drum.5ae1d20c.svg",j=n.p+"static/media/construction.9e9ab6c6.png",b=n.p+"static/media/drumbeat.e0f520f5.mp3",h=n.p+"static/media/musical-note.49e6a279.svg",O=n(201),x=n.n(O),v=n(94),y=n(385),w=n(18),k=f.a.createContext({updateDrumCount:function(){return Promise.resolve({isSuccessful:!1})},getDrumCount:function(){return Promise.resolve({isSuccessful:!1})},claim:function(){return Promise.resolve({isSuccessful:!1})},syncRewards:function(){return Promise.resolve({isSuccessful:!1})}}),g="https://trydrum-backend.herokuapp.com",C=function(e){var t=e.children,n=Object(l.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(g+"/users/drum/".concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amt:t})});case 2:if(!(r=e.sent).ok){e.next=5;break}return e.abrupt("return",{isSuccessful:!0});case 5:return e.abrupt("return",{isSuccessful:!1,message:r.statusText});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),c=Object(l.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(g+"/users/drum/claim/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"}});case 2:if(!(n=e.sent).ok){e.next=7;break}return e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return",{isSuccessful:!1,message:n.statusText});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),a=Object(l.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(g+"/users/drum/".concat(t),{method:"GET"});case 2:if(!(n=e.sent).ok){e.next=7;break}return e.next=6,n.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),i=Object(l.useCallback)(function(){var e=Object(u.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(g+"/users/drum/sync/".concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tempAddress:t})});case 2:if(!(r=e.sent).ok){e.next=7;break}return e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:return e.abrupt("return",{isSuccessful:!1,message:r.statusText});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]);return Object(r.jsx)(k.Provider,{value:{updateDrumCount:n,claim:c,getDrumCount:a,syncRewards:i},children:t})},S="localhost"===window.location.hostname?"ws://localhost:8000":"wss://trydrum-backend.herokuapp.com",A=x()(S,{transports:["websocket"]}),R=new w.i({name:"Beacon Docs"}),T=Object(y.a)();var N=function(){var e=Object(l.useState)(),t=Object(i.a)(e,2),n=t[0],c=t[1],O=f.a.createRef(),x=f.a.createRef(),w=Object(l.useRef)(),g=Object(l.useRef)(0),C=Object(l.useState)([]),S=Object(i.a)(C,2),N=S[0],P=S[1],D=Object(l.useState)(!1),z=Object(i.a)(D,2),E=z[0],B=z[1],q=Object(l.useContext)(k),J=q.updateDrumCount,F=q.claim,I=q.getDrumCount,L=q.syncRewards,G=Object(l.useState)(-1),M=Object(i.a)(G,2),U=M[0],H=M[1],W=Object(v.b)().enqueueSnackbar,K=Object(l.useState)({top:0,left:0}),Q=Object(i.a)(K,2),V=Q[0],X=Q[1],Y=Object(l.useState)("sync"),Z=Object(i.a)(Y,2),$=Z[0],_=Z[1],ee=Object(l.useState)(!1),te=Object(i.a)(ee,2),ne=te[0],re=te[1],ce=Object(l.useState)(0),se=Object(i.a)(ce,2),ae=se[0],ue=se[1],ie=window.innerWidth<=500;function oe(e){return de.apply(this,arguments)}function de(){return(de=Object(u.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.tezos.domains/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:'\n            {\n              reverseRecord(address: "'+t+'"){owner domain{name}}\n            }\n            ',variables:{}})}).then((function(e){return e.json()})).then((function(e){e.data.reverseRecord&&(n=e.data.reverseRecord.domain.name,_(n))}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(){return(le=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c,e.next=3,R.getActiveAccount();case 3:e.t1=e.sent,(0,e.t0)(e.t1),n?(_(n.address.slice(0,6)+"..."+n.address.slice(32,36)),re(!0),oe(n.address)):(_("sync"),re(!1));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(l.useEffect)((function(){!function(){le.apply(this,arguments)}()}),[n]),Object(l.useEffect)((function(){x.current&&(w.current=x.current)}));var fe=Object(l.useCallback)((function(){if(O.current){var e=O.current.getBoundingClientRect();X({top:e.top-e.height/2,left:e.left+e.width/2-25})}}),[O]);function pe(){return(pe=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c,e.next=3,R.getActiveAccount();case 3:e.t1=e.sent,(0,e.t0)(e.t1),n&&R.clearActiveAccount().then(Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c,e.next=3,R.getActiveAccount();case 3:e.t1=e.sent,(0,e.t0)(e.t1),_("sync"),re(!1),ue(0);case 8:case"end":return e.stop()}}),e)}))));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(){return je.apply(this,arguments)}function je(){return(je=Object(u.a)(s.a.mark((function e(){var t,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c,e.next=3,R.getActiveAccount();case 3:if(e.t1=e.sent,(0,e.t0)(e.t1),!n){e.next=17;break}return _(n.address),re(!0),oe(n.address),e.next=11,L(T,permissions.address);case 11:return t=e.sent.updatedBalance,console.log(t),ue(t),e.abrupt("return",n);case 17:return e.prev=17,console.log("Requesting permissions..."),e.next=21,R.requestPermissions();case 21:return r=e.sent,e.t2=c,e.next=25,R.getActiveAccount();case 25:return e.t3=e.sent,(0,e.t2)(e.t3),console.log("Got permissions:",r.address),_(r.address),re(!0),oe(r.address),e.next=33,L(T,r.address);case 33:a=e.sent.updatedBalance,console.log(a),ue(a),I(r.address).then((function(e){e&&(H(e.count),ue(e.claim))})),e.next=42;break;case 39:e.prev=39,e.t4=e.catch(17),console.log("Got error:",e.t4);case 42:case"end":return e.stop()}}),e,null,[[17,39]])})))).apply(this,arguments)}function be(){return he.apply(this,arguments)}function he(){return(he=Object(u.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W("Sending "+ae+" DRUM !",{variant:"default"}),e.next=3,F(n?n.address:T);case 3:(t=e.sent).success?W(Object(r.jsxs)("div",{onClick:function(){window.open(t.message)},children:[" hash:  ",t.message,"  "]}),{variant:"success"}):W(t.message,{variant:"error"}),ue(0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(l.useEffect)((function(){I(n?n.address:T).then((function(e){e&&(H(e.count),ue(e.claim))}))}),[I,n]),Object(l.useEffect)((function(){var e=function(){w.current&&(w.current.currentTime=0,w.current.play(),H((function(e){return e+1}))),P((function(e){return e.concat({key:Object(y.a)()})})),W("someone beat the drum!",{variant:"default"})};return A.on("drumbeat",e),window.addEventListener("resize",fe),function(){A.off("drumbeat",e),window.removeEventListener("resize",fe)}}),[W,fe]),Object(l.useEffect)((function(){!O.current||0!==V.top&&0!==V.left||fe()}),[O,V,fe]),Object(r.jsxs)("div",{className:"app-container",style:{minHeight:window.innerHeight-10},children:[Object(r.jsx)("audio",{src:b,ref:x,autoPlay:!0,muted:!0}),Object(r.jsx)("div",{className:"top-left",style:{fontSize:ie?"1em":"1.5em"},children:"drum"}),Object(r.jsx)("div",{className:"top-middle"}),U>=0&&Object(r.jsxs)("div",{className:"top-right",style:{fontSize:ie?"1em":"1.5em"},children:[U,"  "]}),Object(r.jsx)("img",{ref:O,onClick:function(){P((function(e){return e.concat({key:Object(y.a)()})})),B(!0),x.current&&(x.current.muted=!1,x.current.currentTime=0,x.current.play()),A.emit("drumbeat"),null!==g.current?(g.current++,J(g.current,n?n.address:T)):g.current=0,H((function(e){return e+1})),ue((function(e){return e+1}))},alt:"drum",src:m,className:"drum"}),!E&&Object(r.jsx)("div",{children:"Click the drum!"}),Object(r.jsx)(o.a,{children:N.map((function(e){return Object(r.jsx)(d.a,{timeout:1e3,classNames:"note-transition",onEntered:function(){var t=N.findIndex((function(t){return t.key===e.key}));P([].concat(Object(a.a)(N.slice(0,t)),Object(a.a)(N.slice(t+1))))},children:Object(r.jsx)("img",{alt:"music note",src:h,className:"music-note",style:{top:V.top,left:V.left}})},e.key)}))}),Object(r.jsx)("div",{className:"bottom-left",children:Object(r.jsxs)(p.a,{title:"Adventure Networks",size:ie?"small":"medium",onClick:function(){window.open("https://adventurenetworks.net/#/")},children:["  ",Object(r.jsxs)("div",{style:{textAlign:"left"},children:[" Adventure ",Object(r.jsx)("br",{}),"Networks "]})," "]})}),Object(r.jsxs)("div",{className:"bottom-right",children:[Object(r.jsxs)("div",{children:["  ",Object(r.jsx)("img",{style:{width:30},src:j})," under construction ",Object(r.jsx)("img",{style:{width:30},src:j})," "]}),Object(r.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:ne?Object(r.jsxs)(p.a,{title:"claim",size:ie?"small":"medium",onClick:Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be();case 2:case"end":return e.stop()}}),e)}))),children:["  Claim ",ae," DRUM  "]}):Object(r.jsxs)("div",{style:{fontSize:ie?"1em":"1.1em",marginRight:12},children:[" sync to claim ",ae," DRUM "]})}),Object(r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[ne&&Object(r.jsxs)(p.a,{size:ie?"small":"medium",title:"unsync",onClick:function(){!function(){pe.apply(this,arguments)}()},children:[Object(r.jsx)("u",{children:"unsync"})," "]}),ne&&Object(r.jsx)("div",{children:" | "}),Object(r.jsxs)(p.a,{title:"sync",size:ie?"small":"medium",onClick:Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me();case 2:case"end":return e.stop()}}),e)}))),children:[Object(r.jsx)("u",{children:$})," "]})]})]})]})},P=n(28),D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,390)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,s=t.getLCP,a=t.getTTFB;n(e),r(e),c(e),s(e),a(e)}))};n.n(P).a.render(Object(r.jsx)(C,{children:Object(r.jsx)(v.a,{maxSnack:3,children:Object(r.jsx)(N,{})})}),document.getElementById("root")),D()}},[[360,1,2]]]);
//# sourceMappingURL=main.0d035aee.chunk.js.map