(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{139:function(e,t){},211:function(e,t,n){},213:function(e,t,n){},250:function(e,t){},252:function(e,t){},262:function(e,t){},264:function(e,t){},291:function(e,t){},293:function(e,t){},294:function(e,t){},300:function(e,t){},302:function(e,t){},320:function(e,t){},322:function(e,t){},334:function(e,t){},337:function(e,t){},360:function(e,t,n){"use strict";n.r(t);var c=n(13),r=(n(211),n(9)),s=n(0),a=n.n(s),i=n(41),u=n(18),o=(n(213),n(388)),d=n(387),l=n(1),f=n.n(l),m=f.a.createContext({updateDrumCount:function(){return Promise.resolve({isSuccessful:!1})},getDrumCount:function(){return Promise.resolve({isSuccessful:!1})},claim:function(){return Promise.resolve({isSuccessful:!1})}}),p="https://trydrum-backend.herokuapp.com",j=function(e){var t=e.children,n=Object(l.useCallback)(function(){var e=Object(i.a)(a.a.mark((function e(t,n){var c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("ich will "+t),e.next=3,fetch(p+"/users/drum/".concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amt:t})});case 3:if(!(c=e.sent).ok){e.next=6;break}return e.abrupt("return",{isSuccessful:!0});case 6:return e.abrupt("return",{isSuccessful:!1,message:c.statusText});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),r=Object(l.useCallback)(function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(p+"/users/drum/claim/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"}});case 2:if(!(n=e.sent).ok){e.next=5;break}return e.abrupt("return",{isSuccessful:!0});case 5:return e.abrupt("return",{isSuccessful:!1,message:n.statusText});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),s=Object(l.useCallback)(function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("get will "),e.next=3,fetch(p+"/users/drum/".concat(t),{method:"GET"});case 3:if(!(n=e.sent).ok){e.next=8;break}return e.next=7,n.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);return Object(c.jsx)(m.Provider,{value:{updateDrumCount:n,claim:r,getDrumCount:s},children:t})},b=n(386),h=n.p+"static/media/drum.5ae1d20c.svg",O=n.p+"static/media/construction.9e9ab6c6.png",v=n.p+"static/media/drumbeat.e0f520f5.mp3",x=n(201),y=n.n(x),g=n.p+"static/media/musical-note.49e6a279.svg",k=n(94),w=n(385),S=n(19),C="localhost"===window.location.hostname?"ws://localhost:8000":"wss://trydrum-backend.herokuapp.com",R=y()(C,{transports:["websocket"]}),T=new S.i({name:"Beacon Docs"}),N=Object(w.a)();var A=function(){var e=Object(l.useState)(),t=Object(u.a)(e,2),n=t[0],s=t[1],p=f.a.createRef(),j=f.a.createRef(),x=Object(l.useRef)(),y=Object(l.useRef)(0),S=Object(l.useState)([]),C=Object(u.a)(S,2),A=C[0],z=C[1],D=Object(l.useState)(!1),P=Object(u.a)(D,2),E=P[0],q=P[1],J=Object(l.useContext)(m),U=J.updateDrumCount,B=J.claim,F=J.getDrumCount,I=Object(l.useState)(-1),L=Object(u.a)(I,2),G=L[0],M=L[1],H=Object(k.b)().enqueueSnackbar,W=Object(l.useState)({top:0,left:0}),X=Object(u.a)(W,2),Z=X[0],K=X[1],Q=Object(l.useState)("sync"),V=Object(u.a)(Q,2),Y=V[0],$=V[1],_=Object(l.useState)(0),ee=Object(u.a)(_,2),te=(ee[0],ee[1]),ne=Object(l.useState)(!1),ce=Object(u.a)(ne,2),re=ce[0],se=ce[1],ae=Object(l.useState)(0),ie=Object(u.a)(ae,2),ue=(ie[0],ie[1]),oe=Object(l.useState)(0),de=Object(u.a)(oe,2),le=de[0],fe=de[1],me=window.innerWidth<=500;Object(l.useEffect)((function(){function e(){return(e=Object(i.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s,e.next=3,T.getActiveAccount();case 3:if(e.t1=e.sent,(0,e.t0)(e.t1),!n){e.next=14;break}return $(n.address.slice(0,6)+"..."+n.address.slice(32,36)),e.next=9,fetch("https://api.tezos.domains/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:'\n\t\t\t\t\t\t\t  {\n\t\t\t\t\t\t\t\t  reverseRecord(address: "'+n.address+'"){owner domain{name}}\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t  ',variables:{}})}).then((function(e){return e.json()})).then((function(e){e.data.reverseRecord&&(t=e.data.reverseRecord.domain.name,$(t))}));case 9:se(!0),fetch("https://api.tzkt.io/v1/accounts/"+n.address).then((function(e){return e.json()})).then((function(e){return te(e.balance)})),fetch("https://min-api.cryptocompare.com/data/price?fsym=XTZ&tsyms=USD").then((function(e){return e.json()})).then((function(e){return ue(e.USD)})),e.next=16;break;case 14:$("sync"),se(!1);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n]),Object(l.useEffect)((function(){j.current&&(x.current=j.current)}));var pe=Object(l.useCallback)((function(){if(p.current){var e=p.current.getBoundingClientRect();K({top:e.top-e.height/2,left:e.left+e.width/2-25})}}),[p]);function je(){return(je=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s,e.next=3,T.getActiveAccount();case 3:e.t1=e.sent,(0,e.t0)(e.t1),n&&T.clearActiveAccount().then(Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s,e.next=3,T.getActiveAccount();case 3:e.t1=e.sent,(0,e.t0)(e.t1),$("sync"),se(!1),te(0),fe(0);case 9:case"end":return e.stop()}}),e)}))));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(){return he.apply(this,arguments)}function he(){return(he=Object(i.a)(a.a.mark((function e(){var t,c,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=s,e.next=3,T.getActiveAccount();case 3:if(e.t1=e.sent,(0,e.t0)(e.t1),!n){e.next=14;break}return console.log("Already connected:",n.address),$(n.address),e.next=10,fetch("https://api.tezos.domains/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:'\n              {\n                reverseRecord(address: "'+n.address+'"){owner domain{name}}\n              }\n              ',variables:{}})}).then((function(e){return e.json()})).then((function(e){console.log(e),e.data.reverseRecord&&(t=e.data.reverseRecord.domain.name,$(t))}));case 10:return se(!0),e.abrupt("return",n);case 14:return console.log("Not connected!"),e.prev=15,console.log("Requesting permissions..."),e.next=19,T.requestPermissions();case 19:return c=e.sent,e.t2=s,e.next=23,T.getActiveAccount();case 23:return e.t3=e.sent,(0,e.t2)(e.t3),console.log("Got permissions:",c.address),$(c.address),e.next=29,fetch("https://api.tezos.domains/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:'\n              {\n                reverseRecord(address: "'+c.address+'"){owner domain{name}}\n              }\n              ',variables:{}})}).then((function(e){return e.json()})).then((function(e){console.log(e),e.data.reverseRecord&&(r=e.data.reverseRecord.domain.name,$(r))}));case 29:se(!0),F(c.address).then((function(e){e&&(M(e.count),fe(e.claim))})),fetch("https://api.tzkt.io/v1/accounts/"+c.address).then((function(e){return e.json()})).then((function(e){return te(e.balance)})),e.next=37;break;case 34:e.prev=34,e.t4=e.catch(15),console.log("Got error:",e.t4);case 37:case"end":return e.stop()}}),e,null,[[15,34]])})))).apply(this,arguments)}function Oe(){return ve.apply(this,arguments)}function ve(){return(ve=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B(n?n.address:N),H("Recieved "+le+" DRUM !",{variant:"success"}),fe(0);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(l.useEffect)((function(){F(n?n.address:N).then((function(e){e&&(M(e.count),fe(e.claim))}))}),[F,n]),Object(l.useEffect)((function(){var e=function(){x.current&&(x.current.currentTime=0,x.current.play(),M((function(e){return e+1}))),z((function(e){return e.concat({key:Object(w.a)()})})),H("someone beat the drum!",{variant:"default"})};return R.on("drumbeat",e),window.addEventListener("resize",pe),function(){R.off("drumbeat",e),window.removeEventListener("resize",pe)}}),[H,pe]),Object(l.useEffect)((function(){!p.current||0!==Z.top&&0!==Z.left||pe()}),[p,Z,pe]),Object(c.jsxs)("div",{className:"app-container",style:{minHeight:window.innerHeight-10},children:[Object(c.jsx)("audio",{src:v,ref:j,autoPlay:!0,muted:!0}),Object(c.jsx)("div",{className:"top-left",style:{fontSize:me?"1em":"1.5em"},children:"drum"}),Object(c.jsx)("div",{className:"top-middle"}),G>=0&&Object(c.jsxs)("div",{className:"top-right",style:{fontSize:me?"1em":"1.5em"},children:[G,"  "]}),Object(c.jsx)("img",{ref:p,onClick:function(){z((function(e){return e.concat({key:Object(w.a)()})})),q(!0),j.current&&(j.current.muted=!1,j.current.currentTime=0,j.current.play()),R.emit("drumbeat"),null!==y.current?(y.current++,U(y.current,n?n.address:N)):y.current=0,M((function(e){return e+1})),fe((function(e){return e+1}))},alt:"drum",src:h,className:"drum"}),!E&&Object(c.jsx)("div",{children:"Click the drum!"}),Object(c.jsx)(o.a,{children:A.map((function(e){return Object(c.jsx)(d.a,{timeout:1e3,classNames:"note-transition",onEntered:function(){var t=A.findIndex((function(t){return t.key===e.key}));z([].concat(Object(r.a)(A.slice(0,t)),Object(r.a)(A.slice(t+1))))},children:Object(c.jsx)("img",{alt:"music note",src:g,className:"music-note",style:{top:Z.top,left:Z.left}})},e.key)}))}),Object(c.jsx)("div",{className:"bottom-left",children:Object(c.jsxs)(b.a,{title:"Adventure Networks",size:me?"small":"medium",onClick:function(){window.open("https://adventurenetworks.net/#/")},children:["Adventure ",Object(c.jsx)("br",{})," Networks "]})}),Object(c.jsxs)("div",{className:"bottom-right",children:[Object(c.jsxs)("div",{children:["  ",Object(c.jsx)("img",{style:{width:30},src:O})," under construction ",Object(c.jsx)("img",{style:{width:30},src:O})," "]}),Object(c.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:re?Object(c.jsxs)(b.a,{title:"claim",size:me?"small":"medium",onClick:Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe();case 2:case"end":return e.stop()}}),e)}))),children:["  Claim ",le," DRUM  "]}):Object(c.jsxs)("div",{style:{fontSize:me?"1em":"1.1em",marginRight:12},children:[" sync to claim ",le," DRUM "]})}),Object(c.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[re&&Object(c.jsxs)(b.a,{size:me?"small":"medium",title:"unsync",onClick:function(){!function(){je.apply(this,arguments)}()},children:[Object(c.jsx)("u",{children:"unsync"})," "]}),re&&Object(c.jsx)("div",{children:" | "}),Object(c.jsxs)(b.a,{title:"sync",size:me?"small":"medium",onClick:Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be();case 2:case"end":return e.stop()}}),e)}))),children:[Object(c.jsx)("u",{children:Y})," "]})]})]})]})},z=n(28),D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,390)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,s=t.getLCP,a=t.getTTFB;n(e),c(e),r(e),s(e),a(e)}))};n.n(z).a.render(Object(c.jsx)(j,{children:Object(c.jsx)(k.a,{maxSnack:3,children:Object(c.jsx)(A,{})})}),document.getElementById("root")),D()}},[[360,1,2]]]);
//# sourceMappingURL=main.a29231a8.chunk.js.map